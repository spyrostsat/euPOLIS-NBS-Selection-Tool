{% extends "layout.html" %}

{% block content %}

<!-- ALL SITES SECTION -->
<div class="content-section text-center">
     <form action="{{ url_for('update_active_site') }}" method="POST">
          <fieldset class="form-group">
               <legend class="border-top h2 pt-3">Active Site</legend>
                    <div class="form-group">
                         <select class="text-center form-control form-control-lg" name="all-sites">
                              {% for site in current_user.site %}
                                   <option value="{{site.title}}"
                                   {% if site.title==active_site.title %}
                                        selected="selected"
                                   {% endif %}
                                   >
                                   {{site.title}}
                                   </option>
                              {% endfor %}
                         </select>
                         <input class="mt-4 btn btn-outline-primary btn-md" type="submit" value="Change Active Site">
                         <button type="button" class="mt-4 ml-3 btn btn-outline-danger btn-md" data-bs-toggle="modal" data-bs-target="#TitleModal">Change Active Site's Title</button>
                    </div>
          </fieldset>
     </form>
     <!-- CHANGE ACTIVE SITE's TITLE SECTION -->
</div>

<!-- Change Title Modal -->
<div class="modal fade" id="TitleModal" tabindex="-1" aria-labelledby="TitleModalLabel" aria-hidden="true">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
     <p class="modal-title" id="TitleModalLabel">Type a new title for the active site</p>
     <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
     </button>
</div>
<div class="modal-footer">
   <form action="{{ url_for('update_active_site_title')}}" method="POST">
        <input class="text-center form-control form-control-lg" type="text" name="site_title" size="40" value="{{ active_site.title }}">
        <button type="button" class="btn btn-secondary mt-3 ml-4 mr-4" data-bs-dismiss="modal">Cancel</button>
        <input class="btn btn-danger mt-3 ml-4" type="submit" value="Change Title">
   </form>
</div>
</div>
</div>
</div>


<div class="content-section text-center">
     <!-- CREATE NEW SITE SECTION -->
     <form action="{{ url_for('create_new_site') }}" method="POST">
          <fieldset class="form-group">
               <legend class="border-top h2 pt-3">Create New Site</legend>
                    <div class="form-group">
                         <input class="text-center form-control form-control-lg" type="text" name="site_title" size="40" placeholder="Type New Site's Name">
                         <input class="mt-4 btn btn-outline-primary btn-md" type="submit" value="Create Site">
                    </div>
          </fieldset>
     </form>
     <!--DELETE SITE SECTION-->
     <form action="{{ url_for('delete_site') }}" method="POST">
          <fieldset class="form-group">
               <legend class="border-top h2 pt-3">Delete Existing Site</legend>
                    <div class="form-group">
                         <select class="text-center form-control form-control-lg" name="all-sites">
                              <option value="-1"> </option>
                              {% for site in current_user.site %}
                                   <option value="{{site.id}}">{{site.title}}</option>
                              {% endfor %}
                         </select>
                         <button type="button" class="mt-4 btn btn-outline-danger btn-md m-2 " data-bs-toggle="modal" data-bs-target="#deleteModal">Delete Chosen Site</button>
                    </div>
          </fieldset>
          <!-- Delete Modal -->
          <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
          <div class="modal-dialog">
          <div class="modal-content">
           <div class="modal-header">
             <h5 class="modal-title" id="deleteModalLabel">Are you sure you want to delete this site?</h5>
             <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
             </button>
           </div>
           <div class="modal-footer">
             <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
               <input class="btn btn-danger" type="submit" value="Delete Site">
           </div>
          </div>
          </div>
          </div>
     </form>
</div>

<!-- HERE STARTS THE SECTION OF MODIFICATIONS AGAINST ALL INPUTS/PARAMETERS OF THE ACTIVE SITE -->

<!-- HERE WE DECLARE THE NAME OF THE ACTIVE SITE JUST TO MAKE IT CLEAR -->
<div class="text-center" style="font-size:50px; font-weight:bold;">
     Active Site: {{ active_site.title }}

     <form class="" action="{{ url_for('update_nbs_data') }}" method="POST">
          <div class="table-responsive content-section text-center" style="font-size: 14px;">
               <table id="my-table" class="table table-hover table-bordered table-info table-sm" border="1" style="border:2px solid #000000; border-collapse:collapse">
                    <caption class="pt-4" style="caption-side:top; text-align:center; color:#000000; font-size:30px; font-weight:bold;">Site's Main Concerns Assessment</caption>
                    <thead class="thead-dark">
                    <tr>
                          <th scope="col" class="align-middle">#</th>
                          <th scope="col" class="align-middle">Category</th>
                          <th scope="col" class="align-middle">Concern</th>
                          <th scope="col" class="align-middle">Concern Importance</th>
                          <th scope="col" class="align-middle">Top Site Concern?<br>(Up to 3)</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for i in range(all_ci_ordered|length) %}
                         <tr>
                          <th scope="row" class="align-middle">{{ i + 1 }}</th>
                          <td style="vertical-align : middle;text-align:center;">{{ all_ci_ordered[i].category }}</td>
                          <td style="vertical-align : middle;text-align:center;">{{ all_ci_ordered[i].title }}</td>
                          <td style="vertical-align : middle;text-align:center;">
                               <select name="ci_{{i}}_importance">
                                    {% for importance in ci_importances %}
                                       <option value="{{ importance }}"
                                            {% if importance==all_ci_ordered[i].importance %}
                                                 selected="selected"
                                            {% endif %}
                                            >
                                            {{ importance }}
                                       </option>
                                    {% endfor %}
                               </select>
                          </td>
                          <td>
                               <select name="ci_{{i}}_top">
                                    {% for top in ci_tops %}
                                       <option value="{{ top }}"
                                            {% if top==all_ci_ordered[i].top %}
                                                 selected="selected"
                                            {% endif %}
                                            >
                                            {{ top }}
                                       </option>
                                    {% endfor %}
                               </select>
                         </td>
                         </tr>
                    {% endfor %}
                    <tfoot>
                         <tr>
                              <th colspan="5" class="pt-3 pb-3"><input style="font-size:35px;" class="btn btn-primary btn-lg" type="submit" value="Save Changes"></th>
                         </tr>
                    </tfoot>
                    </tbody>
               </table>
          </div>
     </form>

     <button type="button" class="btn btn-outline-primary btn-md mt-4 mr-4 mb-4" data-bs-toggle="modal" data-bs-target="#addModal">Add a custom concern</button>
     <!-- Add Modal -->
     <div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
          <div class="modal-dialog">
          <div class="modal-content">
          <div class="modal-header">
             <h5 class="modal-title" id="addModalLabel">Choose the category and name of the site's new concern</h5>
             <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
             </button>
          </div>
          <div class="modal-footer">
             <form action="{{ url_for('add_concern')}}" method="POST">
                  <select name="concern_category" style="font-size:22px;">
                         <option value="Urban">Urban</option>
                         <option value="Environmental">Environmental</option>
                         <option value="Social">Social</option>
                         <option value="Economic/Business">Economic/Business</option>
                         <option value="PH & WB (Public Health & Well Being)">PH & WB (Public Health & Well Being)</option>
                  </select>
                  <input class="text-center form-control form-control-lg" type="text" required name="concern_name" size="100" placeholder="New Concern's Name">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                  <input class="btn btn-danger" type="submit" value="Add Concern">
             </form>
          </div>
          </div>
          </div>
     </div>


     <button type="button" class="btn btn-outline-primary btn-md mt-4 mr-4 mb-4" data-bs-toggle="modal" data-bs-target="#renameModal">Rename a concern</button>
     <!-- Rename Modal -->
     <div class="modal fade" id="renameModal" tabindex="-1" aria-labelledby="renameModalLabel" aria-hidden="true">
          <div class="modal-dialog">
          <div class="modal-content">
          <div class="modal-header">
             <h5 class="modal-title" id="renameModalLabel">Choose an existing concern from the list and rename it as you wish</h5>
             <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
             </button>
          </div>
          <div class="modal-footer">
             <form action="{{ url_for('rename_concern')}}" method="POST">
                  <select name="concern_to_rename" style="font-size:16px;">
                       {% for concern in all_ci_ordered %}
                            <option value="{{ concern.title }}">{{ concern.title }}</option>
                       {% endfor %}
                  </select>
                  <input class="text-center form-control form-control-lg" type="text" required name="concern_new_name" size="100" placeholder="Concern's New Name">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                  <input class="btn btn-danger" type="submit" value="Rename Concern">
             </form>
          </div>
          </div>
          </div>
     </div>

     <button type="button" class="btn btn-outline-primary btn-md mt-4 ml-4 mb-4" data-bs-toggle="modal" data-bs-target="#removeModal">Remove a concern</button>
     <!-- Remove Modal -->
     <div class="modal fade" id="removeModal" tabindex="-1" aria-labelledby="removeModalLabel" aria-hidden="true">
          <div class="modal-dialog">
          <div class="modal-content">
          <div class="modal-header">
             <h5 class="modal-title" id="removeModalLabel">Choose the  concern you want to remove</h5>
             <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
             </button>
          </div>
          <div class="modal-footer">
             <form action="{{ url_for('remove_concern')}}" method="POST">
                  <select name="concern_to_remove" style="font-size:16px;">
                       {% for concern in all_ci_ordered %}
                            <option value="{{ concern.id }}">{{ concern.title }}</option>
                       {% endfor %}
                  </select>
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                  <input class="btn btn-danger" type="submit" value="Remove Concern">
             </form>
          </div>
          </div>
          </div>
     </div>

</div>

<div class="text-center mb-3">
     <a class="mt-4 mb-4 btn btn-primary btn-lg pl-4 pr-4" href="{{ url_for('results_page') }}" style="font-size:50px;">Assess Concerns</a>
</div>

<script type="text/javascript">
     let load_page_down = {{ load_page_down|safe }}
     if (load_page_down) {
          window.scrollTo(0, 1800) // if the load_page_down variable is true (i.e. i have pressed the 'save changes' button), then i load the nbs_tool.html page 1800 pixels down
     }
</script>

{% endblock content %}
