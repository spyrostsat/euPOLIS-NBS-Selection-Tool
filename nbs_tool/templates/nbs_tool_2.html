{% extends "layout.html" %}

{% block content %}

<!-- HERE WE DECLARE THE NAME OF THE ACTIVE SITE JUST TO MAKE IT CLEAR -->
<div class="text-center mt-4 mb-4" style="font-size:50px; font-weight:bold;">
     {{ active_site.title }}
</div>


<form action="{{ url_for('update_nbs_data_2') }}" method="POST">
     <div class="table-responsive content-section text-center" style="font-size: 14px;">
          <table class="table table-hover table-bordered table-info table-sm" border="1" style="border:2px solid #000000; border-collapse:collapse">
               <caption class="pt-1" style="caption-side:top; text-align:center; color:#000000; font-size:30px; font-weight:bold;">Nature-Based Solutions (NBS) Titles and Application Ratios</caption>
               <thead class="thead-dark">
               <tr>
               <th scope="col" class="align-middle"> </th>
               {% for i in range(total_nbs_counter) %}
                    <th scope="col" class="align-middle">NBS {{ i + 1 }}</th>
               {% endfor %}
               </tr>
               </thead>
               <tbody>
                    <tr>
                         <th class="align-middle" style="font-size:16px">Name</th>
                         {% for i in range(total_nbs_counter) %}
                              <td><textarea class="text-center" name="nbs{{i}}_title" rows="2" cols="40">{{ active_site.nbs[i].title }}</textarea></td>
                         {% endfor %}
                    </tr>
                    <tr>
                         <th class="align-middle" style="font-size:16px">Application Ratio</th>
                         {% for i in range(total_nbs_counter) %}
                              <td>
                                   <input id="nbs_{{i}}_ratio" type="range" name="nbs_{{i}}_ratio" min="0" max="1" step="0.1" value="{{ active_site.nbs[i].ratio }}" style="width:10vw;">
                                   <span id="nbs_{{i}}_ratio_value">{{ active_site.nbs[i].ratio }}</span>
                              </td>
                         {% endfor %}
                    </tr>
                    <tfoot>
                        <tr>
                             <th class="pt-3 pb-3" scope="row" colspan="{{ total_nbs_counter + 1 }}"><input style="font-size:30px;" class="btn btn-primary btn-lg" type="submit" value="Save Changes"></th>
                        </tr>
                    </tfoot>
               </tbody>
          </table>
     </div>
</form>


<form class="" action="{{ url_for('update_nbs_data_3') }}" method="POST">
     <div class="table-responsive content-section text-center" style="font-size: 14px;">
          <table id="my-table" class="table table-hover table-bordered table-info table-sm" border="1" style="border:2px solid #000000; border-collapse:collapse">
               <caption class="pt-2" style="caption-side:top; text-align:center; color:#000000; font-size:30px; font-weight:bold;">Nature-Based Solutions Efficiency</caption>
               <thead class="thead-dark">
               <tr>
                <th scope="col" class="align-middle">#</th>
                <th scope="col" class="align-middle">Category</th>
                <th scope="col" class="align-middle">Concern</th>
                {% for i in range(total_nbs_counter) %}
                     <th scope="col" class="align-middle">{{ active_site.nbs[i].title }}</th>
                {% endfor %}
               </tr>
               </thead>
               <tbody>
                    {% for i in range(total_ci_counter) %}
                         <tr>
                          <th scope="row" class="align-middle">{{ i + 1 }}</th>

                          <td>{{ all_ci_ordered[i].category }}</td>

                          <td>{{ all_ci_ordered[i].title }}</td>

                         {% for j in range(total_nbs_counter) %}
                              <td>
                                   <select name="nbs_{{j}}_ci_{{i}}">
                                        {% for nbs_ci in nbs_cis %}
                                            <option value="{{ nbs_ci }}"
                                                 {% if nbs_ci==all_nbs_ci_ordered[i][j].impact %}
                                                      selected="selected"
                                                 {% endif %}
                                             >
                                                 {{ nbs_ci }}
                                            </option>
                                        {% endfor %}
                                   </select>
                              </td>
                         {% endfor %}
                         </tr>
                    {% endfor %}
               </tbody>
               <tfoot>
                    <tr>
                         <th colspan="{{ total_nbs_counter + 3 }}" class="pt-3 pb-3"><input style="font-size:35px;" class="btn btn-primary btn-lg" type="submit" value="Save Changes"></th>
                    </tr>
               </tfoot>
     </table>
</div>
</form>

<div class="text-center">
     <button type="button" class="btn btn-outline-success btn-md mt-4 mr-3 mb-4" data-bs-toggle="modal" data-bs-target="#addModal">Add a new NBS</button>
     <!-- Add Modal -->
     <div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
          <div class="modal-dialog">
          <div class="modal-content">
          <div class="modal-header">
             <h5 class="modal-title" id="addModalLabel">Name the new NBS</h5>
             <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
             </button>
          </div>
          <div class="modal-footer">
             <form action="{{ url_for('add_nbs')}}" method="POST">
                  <input class="text-center form-control form-control-lg" style="font-size:16px;" type="text" required name="nbs_name" size="100" placeholder="New NBS Name">
                  <br>
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                  <input class="btn btn-danger" type="submit" value="Add NBS">
             </form>
          </div>
          </div>
          </div>
     </div>

     <button type="button" class="btn btn-outline-danger btn-md mt-4 ml-4 mb-4" data-bs-toggle="modal" data-bs-target="#removeModal">Remove an existing NBS</button>
     <!-- Remove Modal -->
     <div class="modal fade" id="removeModal" tabindex="-1" aria-labelledby="removeModalLabel" aria-hidden="true">
          <div class="modal-dialog">
          <div class="modal-content">
          <div class="modal-header">
             <h5 class="modal-title" id="removeModalLabel">Choose the  NBS you want to remove</h5>
             <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
             </button>
          </div>
          <div class="modal-footer">
             <form action="{{ url_for('remove_nbs')}}" method="POST">
                  <select name="nbs_to_remove" style="font-size:25px; width:100%;">
                       {% for nbs in active_site.nbs %}
                            <option value="{{ nbs.id }}">{{ nbs.title }}</option>
                       {% endfor %}
                  </select>
                  <br>
                  <br>
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                  <input class="btn btn-danger" type="submit" value="Remove NBS">
             </form>
          </div>
          </div>
          </div>
     </div>
</div>

<div class="text-center mb-3">
     <a class="mt-4 btn btn-primary btn-lg mr-4 mb-4" href="{{ url_for('results_page') }}" style="font-size:35px;">Back To Baseline Assessment Results</a>
     <a class="mt-4 btn btn-primary btn-lg ml-4 mb-4" href="{{ url_for('results_page_2') }}" style="font-size:35px;">Assess Nature-Based Solutions</a>
</div>

<script type="text/javascript">
     const total_nbs_counter = {{ total_nbs_counter }}

     for (let i=0; i < total_nbs_counter; i++) {
          document.getElementById(`nbs_${i}_ratio`).onchange = () => {
               document.getElementById(`nbs_${i}_ratio_value`).innerHTML =  parseFloat(document.getElementById(`nbs_${i}_ratio`).value).toFixed(1)
          }
     }

     let load_page_down = {{ load_page_down|safe }}
     if (load_page_down) {
          window.scrollTo(0, 1300) // if the load_page_down variable is true (i.e. i have pressed the 'save changes' button), then i load the nbs_tool.html page 1800 pixels down
     }
</script>

{% endblock content %}
